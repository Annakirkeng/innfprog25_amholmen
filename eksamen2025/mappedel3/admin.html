<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin ansatte</title>

    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>HÃ¸gskolen JS</h1>
    </header>

    <main>
        <section id="addEmployee">
            <h2>Legg til ansatt</h2>

            <form id="employeeForm">
                <label for="name">Navn:</label>
                <input type="text" id="name" required>

                <label for="position">Stilling:</label>
                <select id="position" required>
                    <!--KOMMER-->
                </select>

                <label for="office">Kontor:</label>
                <input type="text" id="office" required>

                <label for="email">Epost:</label>
                <input type="email" id="email" required>


                <label for="courses">Kurs:</label>
                <input type="text" id="courses">

                <button type="submit">Legg til ansatt</button>
            </form>
        </section>

        <section id="allEmployees">
            <h2>Alle ansatte</h2>
                <!--KOMMER-->
        </section>
    </main>

    <script type="module">
        import { employees, positions } from "../mappedel1/register.js"
        import { createEmployeeHTML, removeEmployeeById } from "../mappedel1/action.js"

        const positionSelect = document.getElementById("position")
        const adminListSection = document.getElementById("allEmployees")
        const nameInput = document.getElementById("name")
        const officeInput = document.getElementById("office")
        const emailInput = document.getElementById("email")
        const coursesInput = document.getElementById("courses")
        const employeeForm = document.getElementById("employeeForm")

        positions.forEach((position)=>{
            const option = document.createElement("option")
            option.value = position
            option.textContent = position
            positionSelect.appendChild(option)
        })

        function renderAdminList(){
            adminListSection.innerHTML = ""

            employees.forEach((employee) => {
                const container = document.createElement("section")
                container.innerHTML = createEmployeeHTML(employee)

                const deleteButton = document.createElement("button")
                deleteButton.textContent = "Slett ansatt"

                deleteButton.addEventListener("click", () => {
                    removeEmployeeById(employee.id)
                    renderAdminList()
                })

                container.appendChild(deleteButton)
                adminListSection.appendChild(container)
            })
        }

        employeeForm.addEventListener("submit", (event) => {
            event.preventDefault()
            
            let coursesArray = []
            if (coursesInput.value.trim() !==""){
                coursesArray = coursesInput.value.split(",")

                for (let i = 0; i < coursesArray.length; i++){
                    coursesArray[i] = coursesArray[i].trim()
                }
            }

            const newEmployee = {
                id: employees.lengt + 1,
                name: nameInput.value,
                office: officeInput.value,
                email: emailInput.value,
                positionIndex: positions.indexOf(positionSelect.value),
                courses: coursesArray
            }

            employees.push(newEmployee)

            employeeForm.reset()
            renderAdminList()
        })
        renderAdminList()

    </script>
</body>
</html>